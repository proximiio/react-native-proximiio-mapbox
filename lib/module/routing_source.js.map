{"version":3,"sources":["routing_source.tsx"],"names":["completedStyle","lineCap","lineJoin","lineOpacity","lineColor","lineWidth","remainingStyle","dottedLineStyle","iconImage","iconSize","symbolPlacement","iconAllowOverlap","textAllowOverlap","completedFilterWithLevel","level","remainingFilterWithLevel","symbolFilterWithLevel","lineSymbolFilterWithLevel","dottedLineFilter","isIOS","RoutingSource","props","event","ProximiioRouteEvents","ROUTE_ENDED","onRouteCanceled","ROUTE_CALCULATED","onRoutePreview","ROUTE_PREVIEWED","ROUTE_UPDATED","onRouteUpdated","routeState","update","setState","ProximiioMapbox","style","setRouteState","route","routeStarted","collection","type","features","previewedOrStarted","routePreviewed","showSymbols","length","startIdx","findIndex","f","id","targetIdx","feats","filter","startCoords","geometry","coordinates","start","Feature","point","image","state","startImage","properties","lastFeature","targetCoords","Array","isArray","target","targetImage","push","splice","dotted","feature","lineString","forEach","index","shift","find","distance","distanceMeters","distanceRemaining","separator","chunks","i","usecase","completedFilter","remainingFilter","symbolFilter","lineSymbolFilter","syncKey","Date","getTime","setTimeout","dashedFilter","completedIndex","remainingIndex","directionImage","symbolLayerStyle","iconOffset","lineSymbolLayerStyle","symbolSpacing","on","onRouteEvent","prevProps","unsubscribe","ProximiioMapboxEvents","READY","onReady","off","aboveLayerID","Constants","LAYER_POLYGONS_ABOVE_PATHS","LAYER_ROUTING_LINE_REMAINING","LAYER_USER_MARKER_CONE","LAYER_ROUTING_LINE_COMPLETED","LAYER_ROUTING_DIRECTION","LAYER_ROUTING_LINE_DOTTED","LAYER_ROUTING_SYMBOLS","React","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport MapboxGL, { Expression, LineLayerStyle, SymbolLayerStyle } from '@react-native-mapbox-gl/maps'\nimport equal from 'fast-deep-equal/react'\nimport ProximiioMapbox, { ProximiioMapboxEvents  } from './instance'\nimport { FeatureCollection, ProximiioFeatureType } from './types'\nimport { ProximiioRouteEvents } from './route_managerv2'\nimport Constants from './constants'\nimport { Feature } from './feature'\nimport along from '@turf/along'\nimport { isIOS } from './helpers'\n\nconst completedStyle = {\n  lineCap: 'round',\n  lineJoin: 'round',\n  lineOpacity: 1,\n  lineColor: '#999999',\n  lineWidth: 10\n} as LineLayerStyle\n\nconst remainingStyle = {\n  lineCap: 'round',\n  lineJoin: 'round',\n  lineOpacity: 1,\n  lineColor: '#39c6e1',\n  lineWidth: 10\n} as LineLayerStyle\n\nconst dottedLineStyle = {\n  iconImage: 'blueDot',\n  iconSize: 0.25,\n  symbolPlacement: 'point',\n  iconAllowOverlap: false,\n  textAllowOverlap: false\n} as SymbolLayerStyle\n\nconst completedFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"LineString\"],\n  [\"has\", \"completed\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst remainingFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"LineString\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst symbolFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"Point\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst lineSymbolFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"LineString\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst dottedLineFilter = (isIOS ?\n[ \"all\", [\"==\", \"usecase\", \"route-line-symbol\"] ] :\n[ '==', ['get', 'usecase'], \"route-line-symbol\" ]) as Expression\n\nexport type RouteState = 'preview' | 'started' | 'canceled' | 'off';\n\ninterface Props {\n  aboveLayerID?: string\n  level: number\n  showSymbols?: boolean\n  startImage?: string\n  targetImage?: string\n  directionImage?: string\n  symbolLayerStyle?: SymbolLayerStyle\n  lineSymbolLayerStyle?: SymbolLayerStyle\n  completedStyle?: LineLayerStyle\n  remainingStyle?: LineLayerStyle\n  dottedLineStyle?: SymbolLayerStyle\n  dotted?: boolean\n}\n\ninterface State {\n  // route: ProximiioRoute\n  collection: FeatureCollection\n  completedFilter: Expression\n  remainingFilter: Expression\n  symbolFilter: Expression\n  lineSymbolFilter: Expression\n  dashedFilter: Expression\n  completedIndex: number\n  remainingIndex: number\n  routeState: RouteState\n  syncKey: string\n  startImage: string\n  targetImage: string\n  directionImage: string\n  symbolLayerStyle: SymbolLayerStyle\n  lineSymbolLayerStyle: SymbolLayerStyle\n  completedStyle: LineLayerStyle\n  remainingStyle: LineLayerStyle\n  dottedLineStyle: SymbolLayerStyle\n}\n\nexport class RoutingSource extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      // route: new ProximiioRoute([]),\n      collection: { type: 'FeatureCollection', features: [] } as FeatureCollection,\n      completedFilter: completedFilterWithLevel(props.level),\n      remainingFilter: remainingFilterWithLevel(props.level),\n      symbolFilter: symbolFilterWithLevel(props.level),\n      lineSymbolFilter: lineSymbolFilterWithLevel(props.level),\n      dashedFilter: isIOS ?\n        [ \"all\", [\"==\", \"usecase\", \"route-line-symbol\"] ] :\n        [ '==', ['get', 'usecase'], \"route-line-symbol\" ],\n      completedIndex: 100,\n      remainingIndex: 201,\n      routeState: 'off',\n      syncKey: `routing-source-${new Date().getTime()}`,\n      startImage: props.startImage || 'routeStart',\n      targetImage:  props.targetImage ||'routeTarget',\n      directionImage: props.directionImage || 'routeDirection',\n      symbolLayerStyle: props.symbolLayerStyle || {\n        iconImage: ['get', 'image'],\n        iconAllowOverlap: true,\n        iconOffset: [0.5, 0.5],\n      },\n      lineSymbolLayerStyle: props.lineSymbolLayerStyle || {\n        iconImage: this.props.directionImage || 'routeDirection',\n        iconAllowOverlap: true,\n        symbolSpacing: 100,\n        symbolPlacement: 'line',\n      },\n      remainingStyle: props.remainingStyle || remainingStyle,\n      completedStyle: props.completedStyle || completedStyle,\n      dottedLineStyle: props.dottedLineStyle || dottedLineStyle\n    }\n  }\n\n  componentDidMount() {\n    ProximiioMapbox.route.on(this.onRouteEvent);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (!equal(this.props, prevProps)) {\n      this.setState({\n        startImage: this.props.startImage || 'routeStart',\n        targetImage:  this.props.targetImage ||'routeTarget',\n        directionImage:  this.props.directionImage ||'routeDirection',\n        symbolLayerStyle: this.props.symbolLayerStyle || {\n          iconImage: ['get', 'image'],\n          iconAllowOverlap: true,\n          iconOffset: [0.5, 0.5],\n        },\n        lineSymbolLayerStyle: this.props.lineSymbolLayerStyle || {\n          iconImage: this.props.directionImage || 'routeDirection',\n          iconAllowOverlap: true,\n          symbolPlacement: 'line',\n        },\n        dottedLineStyle: this.props.dottedLineStyle || dottedLineStyle\n      }, () => {\n        this.update()\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    ProximiioMapbox.unsubscribe(ProximiioMapboxEvents.READY, this.onReady);\n    ProximiioMapbox.route.off(this.onRouteEvent);\n  }\n\n  private onRouteEvent = (event?: string) => {\n    if (event === ProximiioRouteEvents.ROUTE_ENDED) {\n      this.onRouteCanceled();\n    } else if (event == ProximiioRouteEvents.ROUTE_CALCULATED) {\n      // TODO handle this event properly??\n      this.onRoutePreview();\n    } else if (event === ProximiioRouteEvents.ROUTE_PREVIEWED) {\n      this.onRoutePreview();\n    } else if (event === ProximiioRouteEvents.ROUTE_UPDATED) {\n      this.onRouteUpdated();\n    }\n  }\n\n  private setRouteState = async (routeState: RouteState) => {\n    await this.update();\n    await this.setState({ routeState })\n  }\n\n  onReady = async () => {\n    if (ProximiioMapbox.style) {\n      this.setRouteState('off')\n    }\n  }\n\n  onRoutePreview = async () => {\n    if (ProximiioMapbox.route.route) {\n      this.setRouteState('preview')\n    }\n  }\n\n  onRouteStarted = async () => {\n    if (ProximiioMapbox.route.route) {\n      this.setRouteState('started')\n    }\n  }\n\n  onRouteUpdated = () => {\n    if (ProximiioMapbox.route.routeStarted) {\n      this.update()\n    }\n  }\n\n  onRouteCanceled = async () => {\n    await this.setRouteState('off')\n    await this.setState({\n      collection: {\n        type: 'FeatureCollection',\n        features: []\n      }\n    })\n  }\n\n  update = async () => {\n    const route = ProximiioMapbox.route.route;\n    const previewedOrStarted = ProximiioMapbox.route.routePreviewed || ProximiioMapbox.route.routeStarted;\n    const features = (previewedOrStarted && route) ? route.features : [];\n\n    if (this.props.showSymbols && features && features.length > 0) {\n      const startIdx = features.findIndex(f => f.id === 'route-start');\n      const targetIdx = features.findIndex(f => f.id === 'route-target');\n      const feats = startIdx >= 0 ? features.filter(f => typeof f.id === 'undefined') : features;\n      const startCoords = features[0].geometry.coordinates[0];\n      const start = Feature.point('route-start', startCoords[1], startCoords[0], {\n        image: this.state.startImage,\n        level: features[0].properties.level\n      }) as ProximiioFeatureType;\n\n      const lastFeature = feats[feats.length - 1];\n      const { geometry: { coordinates } } = lastFeature;\n      const targetCoords = Array.isArray(coordinates[0]) ? coordinates[coordinates.length - 1] : coordinates;\n      \n      const target = Feature.point('route-target', targetCoords[1], targetCoords[0], {\n        image: this.state.targetImage,\n        level: lastFeature.properties.level\n      }) as ProximiioFeatureType;\n\n      if (startIdx === -1) {\n        features.push(start);\n      } else {\n        features.splice(startIdx, 1, start);\n      }\n\n      if (targetIdx === -1) {\n        features.push(target);\n      } else {\n        features.splice(targetIdx, 1, target);\n      }\n    }\n\n    if (route && this.props.dotted) {\n      const feature = Object.assign({}, route.features[0]);\n      const lineString = [feature.geometry.coordinates[0]];\n\n      route.features.filter(f => f.geometry.type === 'LineString').forEach((feature, index) => { \n        const coordinates = [...feature.geometry.coordinates];\n        if (index > 0) {\n          coordinates.shift()\n        }\n\n        lineString.push(...coordinates)\n      });\n\n      const target = features.find(f => f.id === 'route-target');\n      if (target) {\n        lineString.push(target.geometry.coordinates);\n      }\n\n      feature.geometry.coordinates = lineString;\n      const distance = route.distanceMeters;\n      let distanceRemaining = distance;\n      const separator = 0.5; // 1 meter\n      const chunks = [] as any[];\n      let i = 0;\n\n      while (distanceRemaining > separator) {\n        const point = along(feature as any, (separator + i) / 1000)\n        if (point && point.properties) {\n          point.properties.usecase = 'route-line-symbol';\n          chunks.push(point);\n          distanceRemaining -= separator;\n          i += separator;\n        }\n      }\n      features.push(...chunks as any)\n    }\n\n    this.setState({\n      collection: {\n        type: 'FeatureCollection',\n        features\n      },\n      completedFilter: completedFilterWithLevel(this.props.level),\n      remainingFilter: remainingFilterWithLevel(this.props.level),\n      symbolFilter: symbolFilterWithLevel(this.props.level),\n      lineSymbolFilter: lineSymbolFilterWithLevel(this.props.level),\n      syncKey: `routing-source-${new Date().getTime()}`\n    }, () => {\n      // rn mapbox drawing order issue workaround\n      setTimeout(() => {\n        this.setState({ syncKey: `routing-source-${new Date().getTime()}` })\n      }, 1000)\n    })\n  }\n\n  public render() {\n    const aboveLayerID = this.props.aboveLayerID || Constants.LAYER_POLYGONS_ABOVE_PATHS;\n    const syncKey = new Date().getTime();\n\n    return <MapboxGL.ShapeSource\n      id=\"routes\"\n      key={syncKey}\n      shape={this.state.collection}\n      maxZoomLevel={24}>\n\n        { !this.props.dotted && <MapboxGL.LineLayer\n          id={Constants.LAYER_ROUTING_LINE_REMAINING}\n          key={`${Constants.LAYER_ROUTING_LINE_REMAINING}:${syncKey}`}\n          style={this.state.remainingStyle}\n          filter={this.state.remainingFilter}\n          aboveLayerID={aboveLayerID}\n          belowLayerID={Constants.LAYER_USER_MARKER_CONE}\n        /> }\n\n        { !this.props.dotted && <MapboxGL.LineLayer\n          id={Constants.LAYER_ROUTING_LINE_COMPLETED}\n          key={`${Constants.LAYER_ROUTING_LINE_COMPLETED}${syncKey}`}\n          style={this.state.completedStyle}\n          filter={this.state.completedFilter}\n          belowLayerID={Constants.LAYER_ROUTING_LINE_REMAINING}\n        /> }\n\n        { !this.props.dotted && <MapboxGL.SymbolLayer\n          id={Constants.LAYER_ROUTING_DIRECTION}\n          key={`${Constants.LAYER_ROUTING_DIRECTION}${syncKey}`}\n          style={this.state.lineSymbolLayerStyle}\n          filter={this.state.lineSymbolFilter}\n          aboveLayerID={Constants.LAYER_ROUTING_LINE_REMAINING}\n        /> }\n\n      { this.props.dotted && <MapboxGL.SymbolLayer\n        id={Constants.LAYER_ROUTING_LINE_DOTTED}\n        key={`${Constants.LAYER_ROUTING_LINE_DOTTED}${syncKey}`}\n        aboveLayerID={aboveLayerID}\n        filter={dottedLineFilter}\n        style={this.state.dottedLineStyle} /> }\n\n      <MapboxGL.SymbolLayer\n        id={Constants.LAYER_ROUTING_SYMBOLS}\n        key={`${Constants.LAYER_ROUTING_SYMBOLS}${syncKey}`}\n        style={this.state.symbolLayerStyle}\n        filter={this.state.symbolFilter}\n        aboveLayerID={this.props.dotted ? Constants.LAYER_ROUTING_LINE_DOTTED : Constants.LAYER_ROUTING_DIRECTION }\n      />\n\n    </MapboxGL.ShapeSource>\n  }\n}"]}