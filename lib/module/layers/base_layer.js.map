{"version":3,"sources":["base_layer.ts"],"names":["Serializable","BaseLayer","data","id","type","source","sourceLayer","minZoomLevel","minzoom","maxZoomLevel","maxzoom","filter","metadata","paint","json","layout","base","style","Object","keys","forEach","key","level","newFilter","_filter","filterIndex","changed","lvl","Array","isArray","expression"],"mappings":"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","sourcesContent":["// The type of layer is specified  by the \"type\" property, and must be one of background, fill, line, symbol,\n// raster, circle, fill-extrusion, heatmap, hillshade.\n// Except for layers of the background type, each layer needs to refer to a source. Layers take the data that\n// they get from a source, optionally filter features, and then define how those features are styled.\n\nimport { cloneDeep as clone } from 'lodash'\nimport { kebabize } from \"../helpers\"\n\nexport class Serializable {\n  get json() {\n    return kebabize(this)\n  }\n}\n\nexport default class BaseLayer {\n  id: string\n  source?: string // required for all layer types except 'background'\n  sourceLayer?: string\n  type: 'background' | 'fill' | 'line' | 'symbol' | 'raster' | 'circle' | 'fill-extrusion' | 'heatmap' | 'hillshade'\n  minZoomLevel?: number\n  maxZoomLevel?: number\n  filter?: any\n  paint?: Serializable\n  layout?: Serializable\n  metadata?: any\n\n  constructor(data: any) {\n    this.id = data.id\n    this.type = data.type\n    this.source = data.source\n    this.sourceLayer = data['source-layer']\n    this.minZoomLevel = data.minzoom\n    this.maxZoomLevel = data.maxzoom\n    this.filter = data.filter\n    this.metadata = data.metadata\n  }\n\n  get json() {\n    const { id, type, source, sourceLayer, minZoomLevel, maxZoomLevel, filter, metadata } = this\n    const data: any = { id, type }\n    if (source) data.source = source\n    if (sourceLayer) data['source-layer'] = sourceLayer\n    if (minZoomLevel) data.minZoomLevel = minZoomLevel\n    if (maxZoomLevel) data.maxZoomLevel = maxZoomLevel\n    if (filter) data.filter = filter\n\n    if (this.metadata) {\n      data.metadata = metadata\n    }\n\n    if (this.paint) {\n      data.paint = this.paint.json\n    }\n\n    if (this.layout) {\n      data.layout = this.layout.json\n    }\n\n    return data\n  }\n\n  get style() {\n    const base = {...this.paint, ...this.layout} as any\n    // const base = this.layout as any\n    const style = {} as any\n    Object.keys(base).forEach(key => {\n      if (base[key]) {\n        style[key] = base[key]\n      }\n    })\n    return style\n  }\n\n  setFilterLevel(level: number) {\n    const newFilter = clone(this.filter)\n\n    this.filter.forEach((_filter: any, filterIndex: number) => {\n      const filter = clone(_filter)\n      let changed = false;\n\n      if (this.id === 'proximiio-levelchangers') {\n        const lvl = `__level_${level}`\n        if (filterIndex === 3) {\n          filter[1] = lvl;\n          changed = true;\n        }\n        if (filterIndex === 4) {\n          filter[1][1] = lvl;\n          changed = true;\n        }\n      }\n\n      if (Array.isArray(filter)) {\n        if (filter[0] === '==') {\n          const expression = filter[1]\n          if (expression[0] === 'to-number') {\n            if (expression[1][0] === 'get' && expression[1][1] === 'level') {\n              filter[2] = level\n              changed = true\n            }\n          }\n\n          if (expression[0] === 'get' && expression[1] === 'level') {\n            filter[2] = level\n            changed = true\n          }\n        }\n\n        if (filter[0] === '<=') {\n          const expression = filter[1]\n          if (expression[0] === 'to-number') {\n            if (expression[1][0] === 'get' && expression[1][1] === 'level_min') {\n              filter[2] = level\n              changed = true\n            }\n          }\n\n          if (expression[0] === 'get' && expression[1] === 'level_min') {\n            filter[2] = level\n            changed = true\n          }\n        }\n\n        if (filter[0] === '>=') {\n          const expression = filter[1]\n          if (expression[0] === 'to-number') {\n            if (expression[1][0] === 'get' && expression[1][1] === 'level_max') {\n              filter[2] = level\n              changed = true\n            }\n          }\n\n          if (expression[0] === 'get' && expression[1] === 'level_max') {\n            filter[2] = level\n            changed = true\n          }\n        }\n      }\n\n      if (changed) {\n        newFilter[filterIndex] = filter\n      }\n    })\n    this.filter = newFilter\n  }\n}\n"]}