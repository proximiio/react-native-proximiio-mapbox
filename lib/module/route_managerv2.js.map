{"version":3,"sources":["route_managerv2.ts"],"names":["ProximiioMapboxNative","NativeModules","ProximiioRouteEvents","ProximiioRouteManager","routeConfiguration","routeCalculate","_platformRouteConfiguration","routeStarted","routePreviewed","routeFind","routeFindAndPreview","routeFindAndStart","route","notify","ROUTE_PREVIEWED","isIOS","JSON","stringify","routeStart","routeCancel","ROUTE_CALCULATED","event","eventType","undefined","ROUTE_ENDED","ROUTE_UPDATED","Eventable"],"mappings":"i8BAAA,yCACA,sCAEA,kC,wtBAEA,GAAQA,CAAAA,qBAAR,CAAkCC,0BAAlC,CAAQD,qBAAR,C,GAEYE,CAAAA,oB,6DAAAA,oB,EAAAA,oB,kDAAAA,oB,4CAAAA,oB,gDAAAA,oB,2CAAAA,oB,gCAAAA,oB,SAOCC,CAAAA,qB,8HAMX,gCAAc,oEACZ,wBADY,iLAHY,KAGZ,yFAFU,KAEV,eAEb,C,wEAQD,mBAAUC,kBAAV,CAA2D,CACzD,MAAOJ,CAAAA,qBAAqB,CAACK,cAAtB,CAAqC,KAAKC,2BAAL,CAAiCF,kBAAjC,CAArC,CAAP,CACD,C,oBAQD,cAAYA,kBAAZ,CAA6D,CAC3D,KAAKG,YAAL,CAAoB,KAApB,CACA,KAAKC,cAAL,CAAsB,KAAtB,CACAR,qBAAqB,CAACS,SAAtB,CAAgC,KAAKH,2BAAL,CAAiCF,kBAAjC,CAAhC,EACD,C,8BAKD,wBAAsBA,kBAAtB,CAAuE,CACrE,KAAKG,YAAL,CAAoB,KAApB,CACA,KAAKC,cAAL,CAAsB,IAAtB,CACAR,qBAAqB,CAACU,mBAAtB,CAA0C,KAAKJ,2BAAL,CAAiCF,kBAAjC,CAA1C,EACD,C,4BAKD,sBAAoBA,kBAApB,CAAqE,CACnE,KAAKG,YAAL,CAAoB,IAApB,CACA,KAAKC,cAAL,CAAsB,IAAtB,CACAR,qBAAqB,CAACW,iBAAtB,CAAwC,KAAKL,2BAAL,CAAiCF,kBAAjC,CAAxC,EACD,C,uBAKD,kBAAiB,CACf,GAAI,KAAKQ,KAAL,EAAc,IAAd,EAAsB,KAAKJ,cAA3B,EAA6C,CAAC,KAAKD,YAAvD,CAAqE,CACnE,MAAO,MAAP,CACD,CAFD,IAEO,CACL,KAAKC,cAAL,CAAsB,IAAtB,CACA,KAAKK,MAAL,CAAYX,oBAAoB,CAACY,eAAjC,EACA,MAAO,KAAP,CACD,CACF,C,2CAED,qCAAoCV,kBAApC,CAAqF,CACnF,GAAIW,cAAJ,CAAW,CACT,MAAOX,CAAAA,kBAAP,CACD,CAFD,IAEO,CACL,MAAOY,CAAAA,IAAI,CAACC,SAAL,CAAeb,kBAAf,CAAP,CACD,CACF,C,qBAKD,sIACM,KAAKQ,KAAL,EAAc,IAAd,EAAsB,CAAC,KAAKL,YADlC,0BAEI,KAAKA,YAAL,CAAoB,IAApB,CAFJ,kDAGUP,qBAAqB,CAACkB,UAAtB,EAHV,yCAIW,IAJX,yCAMW,KANX,uE,sBAaA,yLACQlB,qBAAqB,CAACmB,WAAtB,EADR,SAEE,KAAKZ,YAAL,CAAoB,KAApB,CAFF,sE,4BAYA,sBAAoBK,KAApB,CAAkD,CAChD,KAAKA,KAAL,CAAaA,KAAb,CACA,KAAKC,MAAL,CAAYX,oBAAoB,CAACkB,gBAAjC,CAAmDR,KAAnD,EACD,C,wBAED,kBAAgBS,KAAhB,CAA4C,CAE1C,GACEA,KAAK,CAACC,SAAN,EAAmB,UAAnB,EACGD,KAAK,CAACC,SAAN,EAAmB,UADtB,EAEGD,KAAK,CAACC,SAAN,EAAmB,iBAFtB,EAGGD,KAAK,CAACC,SAAN,EAAmB,0BAJxB,CAKE,CACA,KAAKf,YAAL,CAAoB,KAApB,CACA,KAAKC,cAAL,CAAsB,KAAtB,CACA,KAAKI,KAAL,CAAaW,SAAb,CACA,KAAKV,MAAL,CAAYX,oBAAoB,CAACsB,WAAjC,CAA8CH,KAA9C,EACD,CAVD,IAUO,CACL,KAAKT,KAAL,CAAaS,KAAK,CAACT,KAAnB,CACA,KAAKC,MAAL,CAAYX,oBAAoB,CAACuB,aAAjC,CAAgDJ,KAAhD,EACD,CACF,C,mCAxHwCK,oB","sourcesContent":["import { NativeModules, Platform } from \"react-native\";\nimport { Eventable } from \"./eventable\";\nimport {ProximiioMapboxRoute, ProximiioRouteConfiguration, ProximiioRouteEvent} from './types';\nimport { isIOS } from \"./helpers\";\n\nconst { ProximiioMapboxNative } = NativeModules;\n\nexport enum ProximiioRouteEvents {\n  ROUTE_CALCULATED = 'proximiio:route:calculated',\n  ROUTE_UPDATED = 'proximiio:route:updated',\n  ROUTE_PREVIEWED = 'proximiio:route:previewed',\n  ROUTE_ENDED = 'proximiio:route:ended',\n}\n\nexport class ProximiioRouteManager extends Eventable {\n\n  route?: ProximiioMapboxRoute\n  routePreviewed: boolean = false\n  routeStarted: boolean = false\n\n  constructor() {\n    super();\n  }\n\n  /* ---------------------------------------------------------------------------------------------------------------- */\n  /* Route Calculation */\n\n  /**\n   * @return {Promise<ProximiioRoute>}\n   */\n  calculate(routeConfiguration: ProximiioRouteConfiguration) {\n    return ProximiioMapboxNative.routeCalculate(this._platformRouteConfiguration(routeConfiguration));\n  }\n\n  /* ---------------------------------------------------------------------------------------------------------------- */\n  /* Route Navigation */\n\n  /**\n   * Find route to navigate on, but do not start navigation or preview it on map.\n   */\n  public find(routeConfiguration: ProximiioRouteConfiguration) {\n    this.routeStarted = false\n    this.routePreviewed = false\n    ProximiioMapboxNative.routeFind(this._platformRouteConfiguration(routeConfiguration));\n  }\n\n  /**\n   * Find route to navigate on, but do not start navigation, only preview it on map.\n   */\n  public findAndPreview(routeConfiguration: ProximiioRouteConfiguration) {\n    this.routeStarted = false\n    this.routePreviewed = true\n    ProximiioMapboxNative.routeFindAndPreview(this._platformRouteConfiguration(routeConfiguration));\n  }\n\n  /**\n   * Find route to navigate on, and immediately start navigation.\n   */\n  public findAndStart(routeConfiguration: ProximiioRouteConfiguration) {\n    this.routeStarted = true\n    this.routePreviewed = true\n    ProximiioMapboxNative.routeFindAndStart(this._platformRouteConfiguration(routeConfiguration));\n  }\n\n  /**\n   * Preview route on map. Returns true if route preview was enabled.\n   */\n  public preview() {\n    if (this.route != null && this.routePreviewed && !this.routeStarted) {\n      return false;\n    } else {\n      this.routePreviewed = true\n      this.notify(ProximiioRouteEvents.ROUTE_PREVIEWED)\n      return true;\n    }\n  }\n\n  private _platformRouteConfiguration(routeConfiguration: ProximiioRouteConfiguration) {\n    if (isIOS) {\n      return routeConfiguration\n    } else {\n      return JSON.stringify(routeConfiguration)\n    }\n  }\n\n  /**\n   * Start prepared route (that is, of the te routeFind* methods was called before and route was successfully found).\n   */\n  public async start() {\n    if (this.route != null && !this.routeStarted) {\n      this.routeStarted = true\n      await ProximiioMapboxNative.routeStart();\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Stops current navigation, or route preview (removes the path from map).\n   */\n  public async cancel() {\n    await ProximiioMapboxNative.routeCancel();\n    this.routeStarted = false\n  }\n\n  /* ---------------------------------------------------------------------------------------------------------------- */\n  /* Event handling */\n\n  /**\n   *\n   * @param route\n   */\n  public onCalculated(route?: ProximiioMapboxRoute) {\n    this.route = route\n    this.notify(ProximiioRouteEvents.ROUTE_CALCULATED, route)\n  }\n\n  public onUpdate(event: ProximiioRouteEvent) {\n    // Test route end\n    if (\n      event.eventType == 'FINISHED'\n      || event.eventType == 'CANCELED'\n      || event.eventType == 'ROUTE_NOT_FOUND'\n      || event.eventType == 'ROUTE_OSRM_NETWORK_ERROR'\n    ) {\n      this.routeStarted = false;\n      this.routePreviewed = false;\n      this.route = undefined;\n      this.notify(ProximiioRouteEvents.ROUTE_ENDED, event);\n    } else {\n      this.route = event.route;\n      this.notify(ProximiioRouteEvents.ROUTE_UPDATED, event);\n    }\n  }\n}\n"]}