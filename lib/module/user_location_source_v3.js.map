{"version":3,"sources":["user_location_source_v3.tsx"],"names":["UserLocationSource","undefined","location","Proximiio","heading","setState","forceUpdate","ProximiioMapbox","subscribe","ProximiioMapboxEvents","STYLE_CHANGED","onChange","FEATURES_CHANGED","LOCATION_UPDATED","onLocationUpdated","CompassHeading","start","accuracy","props","onAccuracyChanged","unsubscribe","stop","visible","state","lng","lat","createIcon","showHeadingIndicator","React","Component","getHeadingIndicatorStyle","iconRotation","iconImage","coneImage","iconSize","iconAllowOverlap","iconRotate","showsUserHeadingIndicator","Constants","LAYER_POLYGONS_ABOVE_PATHS","layerStyles","pluse","background","foreground","proximiBlue","circleRadius","circleColor","circleOpacity","circlePitchAlignment"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport MapboxGL, {Expression} from '@react-native-mapbox-gl/maps';\nimport ProximiioMapbox from 'react-native-proximiio-mapbox';\nimport Proximiio, {ProximiioLocation} from 'react-native-proximiio';\nimport CompassHeading from 'react-native-compass-heading';\nimport coneImage from './assets/cone.png';\nimport Annotation from '@react-native-mapbox-gl/maps/javascript/components/annotations/Annotation';\nimport {ProximiioMapboxEvents} from './instance';\nimport Constants from './constants';\n\ninterface Props {\n  onAccuracyChanged: (accuracy: number) => void;\n  showHeadingIndicator?: boolean;\n  visible?: boolean;\n}\ninterface State {\n  heading?: number;\n  location?: ProximiioLocation;\n}\n\nexport class UserLocationSource extends React.Component<Props, State> {\n  private accuracy = undefined;\n  state = {\n    location: Proximiio.location,\n    heading: 0,\n  } as State;\n\n  componentDidMount() {\n    ProximiioMapbox.subscribe(ProximiioMapboxEvents.STYLE_CHANGED, this.onChange);\n    ProximiioMapbox.subscribe(ProximiioMapboxEvents.FEATURES_CHANGED, this.onChange);\n    ProximiioMapbox.subscribe(ProximiioMapboxEvents.LOCATION_UPDATED, this.onLocationUpdated);\n    CompassHeading.start(2, ({heading, accuracy}) => {\n      this.setState({heading: heading});\n      if (this.accuracy !== accuracy && this.props.onAccuracyChanged) {\n        this.accuracy = accuracy;\n        this.props.onAccuracyChanged(accuracy);\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    ProximiioMapbox.unsubscribe(ProximiioMapboxEvents.STYLE_CHANGED, this.onChange);\n    ProximiioMapbox.unsubscribe(ProximiioMapboxEvents.FEATURES_CHANGED, this.onChange);\n    ProximiioMapbox.unsubscribe(ProximiioMapboxEvents.LOCATION_UPDATED, this.onLocationUpdated);\n    CompassHeading.stop();\n  }\n\n  render() {\n    if (!this.props.visible || !this.state.location) {\n      return null;\n    }\n    return (\n      <Annotation\n        id=\"proximiUserLocation\"\n        animated={true}\n        key={'proximiioUserAnnotation'}\n        coordinates={this.state.location ? [this.state.location.lng, this.state.location.lat] : null}>\n        {createIcon(this.props.showHeadingIndicator, this.state.heading)}\n      </Annotation>\n    );\n  }\n\n  private onLocationUpdated = (location: ProximiioLocation) => {\n    this.setState({location: location});\n  };\n\n  private onChange = () => {\n    this.forceUpdate();\n  };\n}\n\nconst getHeadingIndicatorStyle = (iconRotation?: number) => {\n  return {\n    iconImage: coneImage,\n    iconSize: 3.2,\n    iconAllowOverlap: true,\n    iconRotate: iconRotation,\n  };\n};\n\nexport const createIcon = (showsUserHeadingIndicator?: boolean, heading?: number) => [\n  (showsUserHeadingIndicator ?\n    <MapboxGL.SymbolLayer\n      key=\"proximiioUserLocationConeLayer\"\n      id=\"proximiioUserLocationConeLayer\"\n      aboveLayerID={Constants.LAYER_POLYGONS_ABOVE_PATHS}\n      style={getHeadingIndicatorStyle(heading)}\n    /> : []),\n  <MapboxGL.CircleLayer\n    key=\"proximiioUserLocationPluseCircle\"\n    id=\"proximiioUserLocationPluseCircle\"\n    style={layerStyles.pluse}\n  />,\n  <MapboxGL.CircleLayer\n    key=\"proximiioUserLocationWhiteCircle\"\n    id=\"proximiioUserLocationWhiteCircle\"\n    aboveLayerID=\"proximiioUserLocationPluseCircle\"\n    style={layerStyles.background}\n  />,\n  <MapboxGL.CircleLayer\n    key=\"proximiioUserLocationBlueCicle\"\n    id=\"proximiioUserLocationBlueCicle\"\n    aboveLayerID=\"proximiioUserLocationWhiteCircle\"\n    style={layerStyles.foreground}\n  />,\n];\n\nconst proximiBlue = 'rgb(59,143,214)';\n\nconst layerStyles = {\n  pluse: {\n    circleRadius: 25,\n    circleColor: proximiBlue,\n    circleOpacity: 0.2,\n    circlePitchAlignment: 'map',\n  },\n  background: {\n    circleRadius: 15,\n    circleColor: '#fff',\n    circlePitchAlignment: 'map',\n  },\n  foreground: {\n    circleRadius: 10,\n    circleColor: proximiBlue,\n    circlePitchAlignment: 'map',\n  },\n};\n"]}