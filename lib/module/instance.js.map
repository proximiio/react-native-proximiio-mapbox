{"version":3,"sources":["instance.ts"],"names":["ProximiioMapboxNative","NativeModules","FeatureFilters","POI","feature","isPoi","ProximiioMapboxSyncStatus","ProximiioMapboxEvents","ProximiioMapboxInternalEvents","ProximiioMapbox","NativeEventEmitter","ProximiioRouteManager","authorize","bind","subscribe","unsubscribe","amenityCache","featureCache","token","length","console","log","ROUTE","evt","route","onCalculated","ROUTE_UPDATE","onUpdate","AMENITIES_CHANGED","__amenitiesChanged","FEATURES_CHANGED","__featuresChanged","Proximiio","ProximiioEvents","PositionUpdated","location","updateLocation","lat","lng","sourceType","accuracy","then","result","emitter","emit","LOCATION_UPDATED","FloorChanged","floor","updateLevel","level","axios","create","baseURL","timeout","headers","get","style","data","isReady","title","search","getAmenityCategories","amenities","features","map","f","Feature","Platform","OS","JSON","parse","AsyncStorage","removeItem","isLoadingFeatures","syncFeatures","getFeatures","native","setItem","stringify","getStyle","getSyncStatus","startSyncNow","levelOverrideMap","setLevelOverrideMap","unitConversion","isIOS","setUnitConversion","thresholdInMeters","setStepImmediateThreshold","setStepPreparationThreshold","setRouteFinishThreshold","enabled","setRerouteEnabled","setReRouteThreshold","setUserLocationToRouteSnappingEnabled","threshold","setUserLocationToRouteSnappingThreshold","ttsEnable","ttsDisable","ttsHeadingCorrectionEnabled","thresholdDistanceMeters","thresholdDegrees","ttsHeadingCorrectionThresholds","ttsReassuranceInstructionEnabled","distance","ttsReassuranceInstructionDistance","ttsRepeatLastInstruction","metadataKeys","undefined","ttsHazardAlert","emterEnabled","exitEnabled","ttsSegmentAlert","ttsDecisionAlert","ttsLandmarkAlert","ttsLevelChangerMetadataKeys","event","fn","addListener","removeListener","Error"],"mappings":"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","sourcesContent":["import { NativeEventEmitter, NativeModules, Platform } from 'react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport axios, { AxiosInstance } from 'axios';\nimport Proximiio, { ProximiioEvents, ProximiioLocation, ProximiioFloor } from 'react-native-proximiio'\nimport { isIOS } from './helpers';\nimport {ProximiioFeatureType, ProximiioUnitConversion} from './types'\nimport { Feature } from './feature'\nimport { ProximiioRouteManager } from './route_managerv2';\n\nconst ProximiioMapboxNative = NativeModules.ProximiioMapboxNative;\n\nexport const FeatureFilters = {\n  POI: (feature: Feature) => feature.isPoi\n}\n\nexport type AmenityCategory = {\n  id: string;\n  name: string;\n};\n\nexport type Amenity = {\n  id: string;\n  category_id: string;\n  icon: string;\n  title: string;\n  description: string;\n};\n\nexport enum ProximiioMapboxSyncStatus {\n  INITIAL_WAITING = 'INITIAL_WAITING',\n  INITIAL_NETWORK_ERROR = 'INITIAL_NETWORK_ERROR',\n  INITIAL_RUNNING = 'INITIAL_RUNNING',\n  INITIAL_ERROR = 'INITIAL_ERROR',\n  INITIAL_FINISHED = 'INITIAL_FINISHED',\n  UPDATE_NETWORK_ERROR = 'UPDATE_NETWORK_ERROR',\n  UPDATE_RUNNING = 'UPDATE_RUNNING',\n  UPDATE_ERROR = 'UPDATE_ERROR',\n  UPDATE_FINISHED = 'UPDATE_FINISHED',\n}\n\nexport enum ProximiioMapboxEvents {\n  FAILURE = 'ProximiioMapboxInitialized',\n  READY = 'ProximiioMapboxFailed',\n  LOCATION_UPDATED = 'ProximiioMapboxLocationUpdate',\n  ROUTE = 'ProximiioMapbox.RouteEvent',\n  ROUTE_UPDATE = 'ProximiioMapbox.RouteEventUpdate',\n  ON_LANDMARK = 'ProximiioMapboxOnNavigationLandmark',\n  ON_HAZARD = 'ProximiioMapboxOnNavigationHazard',\n  ON_SEGMENT = 'ProximiioMapboxOnNavigationSegment',\n  ON_DECISION = 'ProximiioMapboxOnNavigationDecision',\n  AMENITIES_CHANGED = 'ProximiioMapboxAmenitiesChanged',\n  FEATURES_CHANGED = 'ProximiioMapboxFeaturesChanged',\n  STYLE_CHANGED = 'ProximiioMapboxStyleChanged',\n  SYNC_STATUS = 'ProximiioMapboxSyncStatusChanged',\n}\n\n/**\n * To be used only internally, as amenities and feaures are cached locally due to size.\n */\nenum ProximiioMapboxInternalEvents {\n  AMENITIES_CHANGED = 'ProximiioMapboxAmenitiesChangedInternal',\n  FEATURES_CHANGED = 'ProximiioMapboxFeaturesChangedInternal',\n}\n\nexport class ProximiioMapbox {\n  token: string = '';\n  style?: any;\n  axios?: AxiosInstance;\n  emitter = new NativeEventEmitter(ProximiioMapboxNative);\n  route: ProximiioRouteManager = new ProximiioRouteManager();\n  amenityCache: Amenity[];\n  featureCache: Feature[];\n  // isLoadingAmenities = false\n  isLoadingFeatures = false\n\n  constructor() {\n    this.authorize = this.authorize.bind(this);\n    this.subscribe = this.subscribe.bind(this);\n    this.unsubscribe = this.unsubscribe.bind(this);\n    this.amenityCache = [];\n    this.featureCache = [];\n  }\n\n  async authorize(token: string) {\n    if (this.token.length > 0) {\n      console.log('ProximiioMapbox already authorized, skipping')\n      return\n    }\n\n    this.token = token;\n\n    this.subscribe(ProximiioMapboxEvents.ROUTE, evt => this.route.onCalculated(evt));\n    this.subscribe(ProximiioMapboxEvents.ROUTE_UPDATE, evt => this.route.onUpdate(evt));\n    this.subscribe(ProximiioMapboxInternalEvents.AMENITIES_CHANGED, this.__amenitiesChanged.bind(this));\n    this.subscribe(ProximiioMapboxInternalEvents.FEATURES_CHANGED, this.__featuresChanged.bind(this));\n\n    await ProximiioMapboxNative.authorize(token);\n\n    Proximiio.subscribe(ProximiioEvents.PositionUpdated, (location: ProximiioLocation) => {\n      ProximiioMapboxNative.updateLocation(location.lat, location.lng, location.sourceType, location.accuracy).then((result: ProximiioLocation) => {\n        // let location: ProximiioLocation = {\n        //   lng: result.lng,\n        //   lat: result.lat,\n        //   sourceType: result.sourceType,\n        //   accuracy: result.accuracy,\n        // };\n        this.emitter.emit(ProximiioMapboxEvents.LOCATION_UPDATED, result);\n      });\n    });\n\n    Proximiio.subscribe(ProximiioEvents.FloorChanged, (floor?: ProximiioFloor) => {\n      ProximiioMapboxNative.updateLevel(floor?.level || 0);\n    });\n\n    this.axios = axios.create({\n      baseURL: 'https://api.proximi.fi',\n      timeout: 60000,\n      headers: {'Authorization': `Bearer ${token}`}\n    });\n\n    this.style = (await this.axios.get('/v5/geo/style')).data;\n  }\n\n  get styleURL() {\n    if (this.token === '') {\n      throw new Error('ProximiioMapbox is not authorized')\n    }\n\n    return `https://api.proximi.fi/v5/geo/style?token=${this.token}`\n  }\n\n  isReady(): Promise<boolean> {\n    return ProximiioMapboxNative.isReady();\n  }\n\n  search(title: string): Promise<Feature[]> {\n    return ProximiioMapboxNative.search(title);\n  }\n\n  getAmenityCategories(): Promise<AmenityCategory[]> {\n    return ProximiioMapboxNative.getAmenityCategories();\n  }\n  __amenitiesChanged(amenities: Amenity[]) {\n    this.amenityCache = amenities;\n    this.emitter.emit(ProximiioMapboxEvents.AMENITIES_CHANGED);\n  }\n\n  async __featuresChanged(features: Feature[]) {\n    this.featureCache = features.map((f: Feature) => {\n      return new Feature(Platform.OS === 'ios' ? f : JSON.parse(f as unknown as string));\n    });\n    this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n  }\n\n  getAmenities(): Amenity[] {\n    return this.amenityCache;\n  }\n\n  getFeatures(): Feature[] {\n    return this.featureCache;\n  }\n\n  // TODO: this flow was replaced due to frequent race conditions\n  // async getAmenities(): Promise<Amenity[]> {\n  //   if (this.amenityCache.length > 0) {\n  //     return this.amenityCache;\n  //   }\n  //\n  //   const local = await AsyncStorage.getItem('proximiio:amenities');\n  //\n  //   if (local) {\n  //     const parsed = JSON.parse(local);\n  //     console.log('getAmenities - local | count: ', parsed.length, parsed);\n  //     if (parsed.length > 0) {\n  //       this.amenityCache = JSON.parse(local) as Amenity[];\n  //       console.log('getAmenities - local used: ', this.amenityCache);\n  //       return this.amenityCache;\n  //     }\n  //   }\n  //\n  //   if (this.isLoadingAmenities) {\n  //     console.log('isLoadingAmenities!');\n  //     return [] as Amenity[]\n  //   }\n  //\n  //   if (Platform.OS === 'ios') {\n  //     await ProximiioMapboxNative.syncAmenities();\n  //   }\n  //\n  //   this.isLoadingAmenities = true;\n  //   this.amenityCache = (await ProximiioMapboxNative.getAmenities()) as Amenity[];\n  //   await AsyncStorage.setItem('proximiio:amenities', JSON.stringify(this.amenityCache));\n  //   this.emitter.emit(ProximiioMapboxEvents.AMENITIES_CHANGED);\n  //\n  //   console.log('getAmenities | count: ', this.amenityCache.length);\n  //   return this.amenityCache;\n  // }\n  //\n  // async getFeatures(): Promise<Feature[]> {\n  //   if (this.featureCache.length > 0) {\n  //     return this.featureCache\n  //   }\n  //\n  //   const local = await AsyncStorage.getItem('proximiio:features');\n  //\n  //   if (local) {\n  //     const parsed = JSON.parse(local);\n  //     if (parsed.length > 0) {\n  //       this.featureCache = JSON.parse(local).map((f: any) => new Feature(f));\n  //       this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n  //       return this.featureCache;\n  //     }\n  //   }\n  //\n  //   if (this.isLoadingFeatures) {\n  //     return [] as Feature[]\n  //   }\n  //\n  //   this.isLoadingFeatures = true;\n  //\n  //   if (Platform.OS === 'ios') {\n  //     await ProximiioMapboxNative.syncFeatures();\n  //   }\n  //\n  //   const native = (await ProximiioMapboxNative.getFeatures())\n  //     .map((f: ProximiioFeatureType) => new Feature(Platform.OS === 'ios' ? f : JSON.parse(f as unknown as string) ))\n  //\n  //   this.featureCache = native;\n  //   await AsyncStorage.setItem('proximiio:features', JSON.stringify(this.featureCache));\n  //   this.isLoadingFeatures = false;\n  //   if (native.length > 0) {\n  //     this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n  //   }\n  //   return this.featureCache\n  // }\n\n  // TODO is this necessary?\n  async syncFeatures(): Promise<void> {\n    await AsyncStorage.removeItem('proximiio:features');\n    this.isLoadingFeatures = true;\n\n    if (Platform.OS === 'ios') {\n      await ProximiioMapboxNative.syncFeatures();\n    }\n\n    const native = (await ProximiioMapboxNative.getFeatures())\n      .map((f: ProximiioFeatureType) => new Feature(Platform.OS === 'ios' ? f : JSON.parse(f as unknown as string) ))\n\n    this.featureCache = native;\n    await AsyncStorage.setItem('proximiio:features', JSON.stringify(this.featureCache));\n    this.isLoadingFeatures = false;\n    if (native.length > 0) {\n      this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n    }\n  }\n\n  getStyle(): Promise<string> {\n    return ProximiioMapboxNative.getStyle();\n  }\n\n  getSyncStatus(): Promise<number> {\n    return ProximiioMapboxNative.getSyncStatus();\n  }\n\n  startSyncNow() {\n    ProximiioMapboxNative.startSyncNow();\n  }\n\n  /**\n   * Map int -> int, e.g.: <code>{'-1': 0, '0': 1, '1': 2}</code>\n   */\n  setLevelOverrideMap(levelOverrideMap: Map<number, number>) {\n    ProximiioMapboxNative.setLevelOverrideMap(levelOverrideMap);\n  }\n\n  // configure units that should be used for guidance (please make sure you have defined this unit in guidance translations in editor)\n  setUnitConversion(unitConversion: ProximiioUnitConversion) {\n    if (isIOS) {\n      ProximiioMapboxNative.setUnitConversion(unitConversion);\n    } else {\n      ProximiioMapboxNative.setUnitConversion(JSON.stringify(unitConversion));\n    }\n  }\n\n  // set distance before a change in direction when the instruction should be considered 'immediate'\n  setStepImmediateThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setStepImmediateThreshold(thresholdInMeters);\n  }\n\n  // set distance before a change in direction when the instruction should be considered comming 'soon' and possibly warn the user about upcoming event\n  setStepPreparationThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setStepPreparationThreshold(thresholdInMeters);\n  }\n\n  // set a threshold which regulates how far from a destination user must be to be considered he arrived,\n  setRouteFinishThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setRouteFinishThreshold(thresholdInMeters);\n  }\n\n  // enable rerouting if the user strays from path\n  setRerouteEnabled(enabled: boolean) {\n    ProximiioMapboxNative.setRerouteEnabled(enabled);\n  }\n\n  // // configure threshold when the user is considered strayed from path\n  setReRouteThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setReRouteThreshold(thresholdInMeters);\n  }\n\n  setUserLocationToRouteSnappingEnabled(enabled: boolean) {\n    ProximiioMapboxNative.setUserLocationToRouteSnappingEnabled(enabled);\n  }\n\n  setUserLocationToRouteSnappingThreshold(threshold: number) {\n    ProximiioMapboxNative.setUserLocationToRouteSnappingThreshold(threshold);\n  }\n\n  ttsEnabled(enabled: boolean) {\n    if (enabled) {\n      ProximiioMapboxNative.ttsEnable();\n    } else {\n      ProximiioMapboxNative.ttsDisable();\n    }\n  }\n\n  /**\n   * Enables TTS user warnings about:\n   * - starting orientation of the route (which way should user turn to start walking)\n   * - when user is walking the wrong way.\n   * @param enabled\n   */\n  ttsHeadingCorrectionEnabled(enabled: boolean) {\n    ProximiioMapboxNative.ttsHeadingCorrectionEnabled(enabled);\n  }\n\n  /**\n   * Set thresholds to determine when is the heading correction triggered.\n   * @param thresholdMeters distance from route to trigger correction. Default 3 meters.\n   * @param thresholdDegrees degrees between current heading and heading towards correct route. Default 90 degrees.\n   */\n  ttsHeadingCorrectionThresholds(thresholdDistanceMeters: number, thresholdDegrees: number) {\n    ProximiioMapboxNative.ttsHeadingCorrectionThresholds(thresholdDistanceMeters, thresholdDegrees);\n  }\n\n  ttsReassuranceInstructionEnabled(enabled: boolean) {\n    ProximiioMapboxNative.ttsReassuranceInstructionEnabled(enabled);\n  }\n\n  ttsReassuranceInstructionDistance(distance: Number) {\n    ProximiioMapboxNative.ttsReassuranceInstructionDistance(distance);\n  }\n\n  ttsRepeatLastInstruction() {\n    ProximiioMapboxNative.ttsRepeatLastInstruction();\n  }\n\n  ttsHazardAlert(enabled: boolean, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsHazardAlert(enabled, metadataKeys);\n  }\n\n  ttsSegmentAlert(emterEnabled: boolean, exitEnabled: boolean, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsSegmentAlert(emterEnabled, exitEnabled, metadataKeys);\n  }\n\n  ttsDecisionAlert(enabled: boolean, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsDecisionAlert(enabled, metadataKeys);\n  }\n\n  ttsLandmarkAlert(enabled: true, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsLandmarkAlert(enabled, metadataKeys);\n  }\n\n  ttsLevelChangerMetadataKeys(metadataKeys: number[]) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsLevelChangerMetadataKeys(metadataKeys);\n  }\n\n  ttsDestinationMetadataKeys(metadataKeys: number[]) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsLevelChangerMetadataKeys(metadataKeys);\n  }\n\n  subscribe(event: string, fn: (data: any) => void) {\n    return this.emitter.addListener(event, fn);\n  }\n\n  unsubscribe(event: string, fn: (data: any) => void) {\n    return this.emitter.removeListener(event, fn);\n  }\n}\n\nexport default new ProximiioMapbox()\n"]}