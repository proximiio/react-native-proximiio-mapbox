{"version":3,"sources":["routing_source.tsx"],"names":["completedStyle","lineCap","lineJoin","lineOpacity","lineColor","lineWidth","remainingStyle","dottedLineStyle","iconImage","iconSize","symbolPlacement","iconAllowOverlap","textAllowOverlap","completedFilterWithLevel","level","remainingFilterWithLevel","symbolFilterWithLevel","lineSymbolFilterWithLevel","dottedLineFilter","isIOS","RoutingSource","props","event","ProximiioRouteEvents","ROUTE_ENDED","onRouteCanceled","ROUTE_CALCULATED","onRoutePreview","ROUTE_PREVIEWED","ROUTE_UPDATED","onRouteUpdated","routeState","update","setState","ProximiioMapbox","style","setRouteState","route","routeStarted","collection","type","features","previewedOrStarted","routePreviewed","showSymbols","length","startIdx","findIndex","f","id","targetIdx","feats","filter","startCoords","geometry","coordinates","start","Feature","point","image","state","startImage","properties","lastFeature","targetCoords","target","targetImage","push","splice","dotted","feature","lineString","forEach","index","shift","find","distance","distanceMeters","distanceRemaining","separator","chunks","i","usecase","completedFilter","remainingFilter","symbolFilter","lineSymbolFilter","syncKey","Date","getTime","setTimeout","dashedFilter","completedIndex","remainingIndex","directionImage","symbolLayerStyle","iconOffset","lineSymbolLayerStyle","symbolSpacing","on","onRouteEvent","prevProps","unsubscribe","ProximiioMapboxEvents","READY","onReady","off","aboveLayerID","Constants","LAYER_POLYGONS_ABOVE_PATHS","LAYER_ROUTING_LINE_REMAINING","LAYER_ROUTING_LINE_COMPLETED","LAYER_ROUTING_DIRECTION","LAYER_ROUTING_LINE_DOTTED","LAYER_ROUTING_SYMBOLS","React","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport MapboxGL, { Expression, LineLayerStyle, SymbolLayerStyle } from '@react-native-mapbox-gl/maps'\nimport equal from 'fast-deep-equal/react'\nimport ProximiioMapbox, { ProximiioMapboxEvents  } from './instance'\nimport { FeatureCollection, ProximiioFeatureType } from './types'\nimport { ProximiioRouteEvents } from './route_managerv2'\nimport Constants from './constants'\nimport { Feature } from './feature'\nimport along from '@turf/along'\nimport { isIOS } from './helpers'\n\nconst completedStyle = {\n  lineCap: 'round',\n  lineJoin: 'round',\n  lineOpacity: 1,\n  lineColor: '#999999',\n  lineWidth: 10\n} as LineLayerStyle\n\nconst remainingStyle = {\n  lineCap: 'round',\n  lineJoin: 'round',\n  lineOpacity: 1,\n  lineColor: '#39c6e1',\n  lineWidth: 10\n} as LineLayerStyle\n\nconst dottedLineStyle = {\n  iconImage: 'blueDot',\n  iconSize: 0.25,\n  symbolPlacement: 'point',\n  iconAllowOverlap: false,\n  textAllowOverlap: false\n} as SymbolLayerStyle\n\nconst completedFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"LineString\"],\n  [\"has\", \"completed\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst remainingFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"LineString\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst symbolFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"Point\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst lineSymbolFilterWithLevel = (level: number) => [\n  \"all\",\n  [\"==\", [\"geometry-type\"], \"LineString\"],\n  [\"==\", [\"to-number\", [\"get\", \"level\"]], level]\n] as Expression\n\nconst dottedLineFilter = (isIOS ?\n[ \"all\", [\"==\", \"usecase\", \"route-line-symbol\"] ] :\n[ '==', ['get', 'usecase'], \"route-line-symbol\" ]) as Expression\n\nexport type RouteState = 'preview' | 'started' | 'canceled' | 'off';\n\ninterface Props {\n  aboveLayerID?: string\n  level: number\n  showSymbols?: boolean\n  startImage?: string\n  targetImage?: string\n  directionImage?: string\n  symbolLayerStyle?: SymbolLayerStyle\n  lineSymbolLayerStyle?: SymbolLayerStyle\n  completedStyle?: LineLayerStyle\n  remainingStyle?: LineLayerStyle\n  dottedLineStyle?: SymbolLayerStyle\n  dotted?: boolean\n}\n\ninterface State {\n  // route: ProximiioRoute\n  collection: FeatureCollection\n  completedFilter: Expression\n  remainingFilter: Expression\n  symbolFilter: Expression\n  lineSymbolFilter: Expression\n  dashedFilter: Expression\n  completedIndex: number\n  remainingIndex: number\n  routeState: RouteState\n  syncKey: string\n  startImage: string\n  targetImage: string\n  directionImage: string\n  symbolLayerStyle: SymbolLayerStyle\n  lineSymbolLayerStyle: SymbolLayerStyle\n  completedStyle: LineLayerStyle\n  remainingStyle: LineLayerStyle\n  dottedLineStyle: SymbolLayerStyle\n}\n\nexport class RoutingSource extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      // route: new ProximiioRoute([]),\n      collection: { type: 'FeatureCollection', features: [] } as FeatureCollection,\n      completedFilter: completedFilterWithLevel(props.level),\n      remainingFilter: remainingFilterWithLevel(props.level),\n      symbolFilter: symbolFilterWithLevel(props.level),\n      lineSymbolFilter: lineSymbolFilterWithLevel(props.level),\n      dashedFilter: isIOS ?\n        [ \"all\", [\"==\", \"usecase\", \"route-line-symbol\"] ] :\n        [ '==', ['get', 'usecase'], \"route-line-symbol\" ],\n      completedIndex: 100,\n      remainingIndex: 201,\n      routeState: 'off',\n      syncKey: `routing-source-${new Date().getTime()}`,\n      startImage: props.startImage || 'routeStart',\n      targetImage:  props.targetImage ||'routeTarget',\n      directionImage: props.directionImage || 'routeDirection',\n      symbolLayerStyle: props.symbolLayerStyle || {\n        iconImage: ['get', 'image'],\n        iconAllowOverlap: true,\n        iconOffset: [0.5, 0.5],\n      },\n      lineSymbolLayerStyle: props.lineSymbolLayerStyle || {\n        iconImage: this.props.directionImage || 'routeDirection',\n        iconAllowOverlap: true,\n        symbolSpacing: 100,\n        symbolPlacement: 'line',\n      },\n      remainingStyle: props.remainingStyle || remainingStyle,\n      completedStyle: props.completedStyle || completedStyle,\n      dottedLineStyle: props.dottedLineStyle || dottedLineStyle\n    }\n  }\n\n  componentDidMount() {\n    ProximiioMapbox.route.on(this.onRouteEvent);\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (!equal(this.props, prevProps)) {\n      this.setState({\n        startImage: this.props.startImage || 'routeStart',\n        targetImage:  this.props.targetImage ||'routeTarget',\n        directionImage:  this.props.directionImage ||'routeDirection',\n        symbolLayerStyle: this.props.symbolLayerStyle || {\n          iconImage: ['get', 'image'],\n          iconAllowOverlap: true,\n          iconOffset: [0.5, 0.5],\n        },\n        lineSymbolLayerStyle: this.props.lineSymbolLayerStyle || {\n          iconImage: this.props.directionImage || 'routeDirection',\n          iconAllowOverlap: true,\n          symbolPlacement: 'line',\n        },\n        dottedLineStyle: this.props.dottedLineStyle || dottedLineStyle\n      }, () => {\n        this.update()\n      })\n    }\n  }\n\n  componentWillUnmount() {\n    ProximiioMapbox.unsubscribe(ProximiioMapboxEvents.READY, this.onReady);\n    ProximiioMapbox.route.off(this.onRouteEvent);\n  }\n\n  private onRouteEvent = (event?: string) => {\n    if (event === ProximiioRouteEvents.ROUTE_ENDED) {\n      this.onRouteCanceled();\n    } else if (event == ProximiioRouteEvents.ROUTE_CALCULATED) {\n      // TODO handle this event properly??\n      this.onRoutePreview();\n    } else if (event === ProximiioRouteEvents.ROUTE_PREVIEWED) {\n      this.onRoutePreview();\n    } else if (event === ProximiioRouteEvents.ROUTE_UPDATED) {\n      this.onRouteUpdated();\n    }\n  }\n\n  private setRouteState = async (routeState: RouteState) => {\n    await this.update();\n    await this.setState({ routeState })\n  }\n\n  onReady = async () => {\n    if (ProximiioMapbox.style) {\n      this.setRouteState('off')\n    }\n  }\n\n  onRoutePreview = async () => {\n    if (ProximiioMapbox.route.route) {\n      this.setRouteState('preview')\n    }\n  }\n\n  onRouteStarted = async () => {\n    if (ProximiioMapbox.route.route) {\n      this.setRouteState('started')\n    }\n  }\n\n  onRouteUpdated = () => {\n    if (ProximiioMapbox.route.routeStarted) {\n      this.update()\n    }\n  }\n\n  onRouteCanceled = async () => {\n    await this.setRouteState('off')\n    await this.setState({\n      collection: {\n        type: 'FeatureCollection',\n        features: []\n      }\n    })\n  }\n\n  update = async () => {\n    const route = ProximiioMapbox.route.route;\n    const previewedOrStarted = ProximiioMapbox.route.routePreviewed || ProximiioMapbox.route.routeStarted;\n    const features = (previewedOrStarted && route) ? route.features : [];\n\n    if (this.props.showSymbols && features.length > 0) {\n      const startIdx = features.findIndex(f => f.id === 'route-start');\n      const targetIdx = features.findIndex(f => f.id === 'route-target');\n      const feats = startIdx >= 0 ? features.filter(f => typeof f.id === 'undefined') : features;\n      const startCoords = features[0].geometry.coordinates[0];\n      const start = Feature.point('route-start', startCoords[1], startCoords[0], {\n        image: this.state.startImage,\n        level: features[0].properties.level\n      }) as ProximiioFeatureType;\n\n      const lastFeature = feats[feats.length - 1];\n      const targetCoords = lastFeature.geometry.coordinates[lastFeature.geometry.coordinates.length - 1];\n\n      const target = Feature.point('route-target', targetCoords[1], targetCoords[0], {\n        image: this.state.targetImage,\n        level: lastFeature.properties.level\n      }) as ProximiioFeatureType;\n\n      if (startIdx === -1) {\n        features.push(start);\n      } else {\n        features.splice(startIdx, 1, start);\n      }\n\n      if (targetIdx === -1) {\n        features.push(target);\n      } else {\n        features.splice(targetIdx, 1, target);\n      }\n    }\n\n    if (route && this.props.dotted) {\n      const feature = Object.assign({}, route.features[0]);\n      const lineString = [feature.geometry.coordinates[0]];\n      route.features.filter(f => f.geometry.type === 'LineString').forEach((feature, index) => { \n        const coordinates = [...feature.geometry.coordinates];\n        if (index > 0) {\n          coordinates.shift()\n        }\n\n        lineString.push(...coordinates)\n      });\n      const target = features.find(f => f.id === 'route-target');\n      if (target) {\n        lineString.push(target.geometry.coordinates);\n      }\n      feature.geometry.coordinates = lineString;\n      const distance = route.distanceMeters;\n      let distanceRemaining = distance;\n      const separator = 0.5; // 1 meter\n      const chunks = [] as any[];\n      let i = 0;\n      while (distanceRemaining > separator) {\n        const point = along(feature as any, (separator + i) / 1000)\n        if (point && point.properties) {\n          point.properties.usecase = 'route-line-symbol';\n          chunks.push(point);\n          distanceRemaining -= separator;\n          i += separator;\n        }\n      }\n      features.push(...chunks as any)\n    }\n\n    this.setState({\n      collection: {\n        type: 'FeatureCollection',\n        features\n      },\n      completedFilter: completedFilterWithLevel(this.props.level),\n      remainingFilter: remainingFilterWithLevel(this.props.level),\n      symbolFilter: symbolFilterWithLevel(this.props.level),\n      lineSymbolFilter: lineSymbolFilterWithLevel(this.props.level),\n      syncKey: `routing-source-${new Date().getTime()}`\n    }, () => {\n      // rn mapbox drawing order issue workaround\n      setTimeout(() => {\n        this.setState({ syncKey: `routing-source-${new Date().getTime()}` })\n      }, 1000)\n    })\n  }\n\n  public render() {\n    const aboveLayerID = this.props.aboveLayerID || Constants.LAYER_POLYGONS_ABOVE_PATHS\n    const syncKey = new Date().getTime();\n\n    return <MapboxGL.ShapeSource\n      id=\"routes\"\n      key={this.state.syncKey}\n      shape={this.state.collection}\n      maxZoomLevel={24}>\n\n        { !this.props.dotted && <MapboxGL.LineLayer\n          id={Constants.LAYER_ROUTING_LINE_REMAINING}\n          key={`${Constants.LAYER_ROUTING_LINE_REMAINING}:${syncKey}`}\n          style={this.state.remainingStyle}\n          filter={this.state.remainingFilter}\n          aboveLayerID={aboveLayerID}\n        /> }\n\n        { !this.props.dotted && <MapboxGL.LineLayer\n          id={Constants.LAYER_ROUTING_LINE_COMPLETED}\n          key={`${Constants.LAYER_ROUTING_LINE_COMPLETED}${syncKey}`}\n          style={this.state.completedStyle}\n          filter={this.state.completedFilter}\n          aboveLayerID={Constants.LAYER_ROUTING_LINE_REMAINING}\n        /> }\n\n        { !this.props.dotted && <MapboxGL.SymbolLayer\n          id={Constants.LAYER_ROUTING_DIRECTION}\n          key={`${Constants.LAYER_ROUTING_DIRECTION}${syncKey}`}\n          style={this.state.lineSymbolLayerStyle}\n          filter={this.state.lineSymbolFilter}\n          aboveLayerID={Constants.LAYER_ROUTING_LINE_REMAINING}\n        /> }\n\n\n      { this.props.dotted && <MapboxGL.SymbolLayer\n        id={Constants.LAYER_ROUTING_LINE_DOTTED}\n        key={`${Constants.LAYER_ROUTING_LINE_DOTTED}${syncKey}`}\n        aboveLayerID={aboveLayerID}\n        filter={dottedLineFilter}\n        style={this.state.dottedLineStyle} /> }\n\n      <MapboxGL.SymbolLayer\n        id={Constants.LAYER_ROUTING_SYMBOLS}\n        key={`${Constants.LAYER_ROUTING_SYMBOLS}${syncKey}`}\n        style={this.state.symbolLayerStyle}\n        filter={this.state.symbolFilter}\n        aboveLayerID={this.props.dotted ? Constants.LAYER_ROUTING_LINE_DOTTED : Constants.LAYER_ROUTING_DIRECTION }\n      /> \n\n    </MapboxGL.ShapeSource>\n  }\n}\n"]}