{"version":3,"sources":["feature.ts"],"names":["POI_TYPE","POI","HAZARD","DOOR","ENTRANCE","TICKET_GATE","DECISION","LANDMARK","ELEVATOR","ESCALATOR","STAIRCASE","TEXT","PoiType","type","title","icon","recursiveSearch","object","_query","query","trim","toLocaleLowerCase","keys","Object","found","k","length","key","match","Geometry","data","coordinates","Feature","id","geometry","properties","title_i18n","JSON","parse","isPoint","images","range","isLevelChanger","Array","isArray","levels","forEach","level","lang","title_18n","description_i18n","description","proximiioToken","map","it","metadata","includes","isElevator","isEscalator","isStairCase","room","usecase","clone","stringify","e","console","log","latitude","longitude"],"mappings":"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","sourcesContent":["export const POI_TYPE = {\n  POI: 'poi',\n  HAZARD: 'hazard',\n  DOOR: 'door',\n  ENTRANCE: 'entrance',\n  TICKET_GATE: 'ticket_gate',\n  DECISION: 'decision',\n  LANDMARK: 'landmark',\n  ELEVATOR: 'elevator',\n  ESCALATOR: 'escalator',\n  STAIRCASE: 'staircase',\n  TEXT: 'text'\n}\n\nexport class PoiType {\n  type: string\n  title: string\n  icon: string\n\n  constructor(type: string, title: string, icon: string) {\n    this.type = type\n    this.title = title\n    this.icon = icon\n  }\n}\n\nconst recursiveSearch = (object: any, _query: string): boolean => {\n  const query = _query.trim().toLocaleLowerCase();\n  const keys = Object.keys(object);\n  let found = false;\n\n  for (let k = 0; k < keys.length; k++) {\n    const key = keys[k];\n    if (typeof object[key] === 'string') {\n      if (object[key].trim().toLocaleLowerCase().match(query)) {\n        found = true;\n        break;\n      }\n    }\n\n    if (typeof object[key] === 'object') {\n      found = recursiveSearch(object[key], query);\n      if (found) {\n        break;\n      }\n    }\n  }\n\n  return found;\n}\n\nexport class Geometry {\n  type: string\n  coordinates: Array<any>\n\n  constructor(data: any) {\n    this.type = data.type\n    this.coordinates = data.coordinates\n  }\n}\n\nexport class Feature {\n  type: \"Feature\" = 'Feature'\n  id: string\n  geometry: Geometry\n  properties: any\n\n  constructor(data: any) {\n    this.id = data.id\n    this.geometry = new Geometry(data.geometry)\n    this.properties = data.properties || {}\n\n    if (typeof this.properties.title_i18n === 'string') {\n      this.properties.title_i18n = JSON.parse(this.properties.title_i18n)\n    }\n\n    if (this.isPoint) {\n      if (!this.properties.images) {\n        this.properties.images = []\n      }\n\n      if (!this.properties.range) {\n        this.properties.range = 3\n      }\n    }\n\n    if (typeof this.properties.images === 'string') {\n      this.properties.images = JSON.parse(this.properties.images)\n    }\n\n    if (this.isLevelChanger && Array.isArray(this.properties.levels)) {\n      this.properties.levels.forEach((level: number) => this.properties[`__level_${level}`] = true)\n    }\n  }\n\n  hasTitle(lang?: string) {\n    if (typeof this.properties === 'undefined') {\n      return false\n    }\n\n    if (lang) {\n      return typeof this.properties.title_18n[lang] !== 'undefined'\n    }\n\n    return typeof this.properties.title !== 'undefined' || (this.properties.title_i18n && typeof this.properties.title_18n['en'] !== 'undefined')\n  }\n\n  getTitle(lang = 'en') {\n    if (this.properties.title_18n) {\n      return this.properties.title_18n[lang]\n    }\n\n    return this.properties.title\n  }\n\n  getDescription(lang = 'en') {\n    if (this.properties.description_i18n) {\n      return this.properties.description_i18n[lang]\n    }\n\n    return this.properties.description\n  }\n\n  getImageUrls(proximiioToken: String) {\n    if (!this.properties.images) {\n      return []\n    }\n    return this.properties.images.map((it: any) => 'https://api.proximi.fi/v5/geo/' + it + '?token=' + proximiioToken);\n  }\n\n  contains(query: string) {\n    const { title_i18n, description_i18n, metadata } = this.properties;\n    if (title_i18n) {\n      if (recursiveSearch(title_i18n, query)) {\n        return true\n      }\n    }\n\n    if (description_i18n) {\n      if (recursiveSearch(description_i18n, query)) {\n        return true\n      }\n    }\n\n    if (metadata) {\n      if (recursiveSearch(metadata, query)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  hasLevel(level: number) {\n    if (this.isLevelChanger) {\n      return this.properties.levels.includes(level)\n    } else {\n      return this.properties.level === level\n    }\n  }\n\n  get isPoint() {\n    return this.geometry.type === 'Point'\n  }\n\n  get isPolygon() {\n    return this.geometry.type === 'Polygon' || this.geometry.type === 'MultiPolygon'\n  }\n\n  get isLineString() {\n    return this.geometry.type === 'LineString' || this.geometry.type === 'MultiLineString'\n  }\n\n  get isPoi() {\n    return this.properties.type === 'poi'\n  }\n\n  get isHazard() {\n    return this.properties.type === POI_TYPE.HAZARD\n  }\n\n  get isLandmark() {\n    return this.properties.type === POI_TYPE.LANDMARK\n  }\n\n  get isDoor() {\n    return this.properties.type === POI_TYPE.DOOR\n  }\n\n  get isEntrance() {\n    return this.properties.type === POI_TYPE.ENTRANCE\n  }\n\n  get isDecisionPoint() {\n    return this.properties.type === POI_TYPE.DECISION\n  }\n\n  get isTicketGate() {\n    return this.properties.type === POI_TYPE.TICKET_GATE\n  }\n\n  get isElevator() {\n    return this.properties.type === POI_TYPE.ELEVATOR\n  }\n\n  get isEscalator() {\n    return this.properties.type === POI_TYPE.ESCALATOR\n  }\n\n  get isStairCase() {\n    return this.properties.type === POI_TYPE.STAIRCASE\n  }\n\n  get isLevelChanger() {\n    return this.isElevator || this.isEscalator || this.isStairCase\n  }\n\n  get isText() {\n    return this.properties.type === 'text'\n  }\n\n  get isRoom() {\n    return this.properties.room\n  }\n\n  get isRouting() {\n    return this.properties.usecase === 'routing'\n  }\n\n  get json() {\n    const clone = JSON.parse(JSON.stringify(this))\n    if (clone.properties.metadata && typeof clone.properties.metadata !== 'object') {\n      try {\n        clone.properties.metadata = JSON.parse(clone.properties.metadata)\n      } catch (e) {\n        console.log('feature parsing failed:', clone.properties.metadata)\n      }\n    }\n    Object.keys(clone.properties).forEach(key => {\n      if (key.match('__level')) {\n        delete clone.properties.key\n      }\n    })\n    return clone\n  }\n\n  static point(id: string, latitude: number, longitude: number, properties?: any) {\n    return new Feature({\n      id,\n      geometry: {\n        type: 'Point',\n        coordinates: [longitude, latitude]\n      },\n      properties\n    })\n  }\n}\n"]}