{"version":3,"sources":["instance.ts"],"names":["ProximiioMapboxNative","NativeModules","ProximiioMapboxSyncStatus","ProximiioMapboxEvents","ProximiioMapboxInternalEvents","ProximiioMapbox","NativeEventEmitter","ProximiioRouteManager","authorize","bind","subscribe","unsubscribe","amenityCache","featureCache","token","length","console","log","Proximiio","ProximiioEvents","PositionUpdated","location","updateLocation","lat","lng","sourceType","accuracy","then","result","emitter","emit","LOCATION_UPDATED","FloorChanged","floor","isIOS","updateFloor","id","updateLevel","level","ROUTE","evt","route","onCalculated","ROUTE_UPDATE","onUpdate","AMENITIES_CHANGED","__amenitiesChanged","FEATURES_CHANGED","__featuresChanged","axios","create","baseURL","timeout","headers","get","style","data","Error","isReady","title","search","getAmenityCategories","amenities","features","map","f","Feature","Platform","OS","JSON","parse","AsyncStorage","removeItem","isLoadingFeatures","syncFeatures","getFeatures","native","setItem","stringify","getStyle","getSyncStatus","startSyncNow","levelOverrideMap","setLevelOverrideMap","unitConversion","setUnitConversion","thresholdInMeters","setStepImmediateThreshold","setStepPreparationThreshold","setRouteFinishThreshold","enabled","setRerouteEnabled","setReRouteThreshold","setUserLocationToRouteSnappingEnabled","threshold","setUserLocationToRouteSnappingThreshold","ttsEnable","ttsDisable","ttsHeadingCorrectionEnabled","thresholdDistanceMeters","thresholdDegrees","ttsHeadingCorrectionThresholds","ttsReassuranceInstructionEnabled","distance","ttsReassuranceInstructionDistance","ttsRepeatLastInstruction","metadataKeys","undefined","ttsHazardAlert","emterEnabled","exitEnabled","ttsSegmentAlert","ttsDecisionAlert","ttsLandmarkAlert","ttsLevelChangerMetadataKeys","event","fn","addListener","removeListener"],"mappings":"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","sourcesContent":["import { NativeEventEmitter, NativeModules, Platform } from 'react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport axios, { AxiosInstance } from 'axios';\nimport Proximiio, { ProximiioEvents, ProximiioLocation, ProximiioFloor } from 'react-native-proximiio'\nimport { isIOS } from './helpers';\nimport {ProximiioFeatureType, ProximiioUnitConversion} from './types'\nimport { Feature } from './feature'\nimport { ProximiioRouteManager } from './route_managerv2';\n\nconst ProximiioMapboxNative = NativeModules.ProximiioMapboxNative;\n\nexport type AmenityCategory = {\n  id: string;\n  name: string;\n};\n\nexport type Amenity = {\n  id: string;\n  category_id: string;\n  icon: string;\n  title: string;\n  description: string;\n};\n\nexport enum ProximiioMapboxSyncStatus {\n  INITIAL_WAITING = 'INITIAL_WAITING',\n  INITIAL_NETWORK_ERROR = 'INITIAL_NETWORK_ERROR',\n  INITIAL_RUNNING = 'INITIAL_RUNNING',\n  INITIAL_ERROR = 'INITIAL_ERROR',\n  INITIAL_FINISHED = 'INITIAL_FINISHED',\n  UPDATE_NETWORK_ERROR = 'UPDATE_NETWORK_ERROR',\n  UPDATE_RUNNING = 'UPDATE_RUNNING',\n  UPDATE_ERROR = 'UPDATE_ERROR',\n  UPDATE_FINISHED = 'UPDATE_FINISHED',\n}\n\nexport enum ProximiioMapboxEvents {\n  FAILURE = 'ProximiioMapboxInitialized',\n  READY = 'ProximiioMapboxFailed',\n  LOCATION_UPDATED = 'ProximiioMapboxLocationUpdate',\n  ROUTE = 'ProximiioMapbox.RouteEvent',\n  ROUTE_UPDATE = 'ProximiioMapbox.RouteEventUpdate',\n  ON_LANDMARK = 'ProximiioMapboxOnNavigationLandmark',\n  ON_HAZARD = 'ProximiioMapboxOnNavigationHazard',\n  ON_SEGMENT = 'ProximiioMapboxOnNavigationSegment',\n  ON_DECISION = 'ProximiioMapboxOnNavigationDecision',\n  AMENITIES_CHANGED = 'ProximiioMapboxAmenitiesChanged',\n  FEATURES_CHANGED = 'ProximiioMapboxFeaturesChanged',\n  STYLE_CHANGED = 'ProximiioMapboxStyleChanged',\n  SYNC_STATUS = 'ProximiioMapboxSyncStatusChanged',\n}\n\n/**\n * To be used only internally, as amenities and feaures are cached locally due to size.\n */\nenum ProximiioMapboxInternalEvents {\n  AMENITIES_CHANGED = 'ProximiioMapboxAmenitiesChangedInternal',\n  FEATURES_CHANGED = 'ProximiioMapboxFeaturesChangedInternal',\n}\n\nexport class ProximiioMapbox {\n  token: string = '';\n  style?: any;\n  axios?: AxiosInstance;\n  emitter = new NativeEventEmitter(ProximiioMapboxNative);\n  route: ProximiioRouteManager = new ProximiioRouteManager();\n  amenityCache: Amenity[];\n  featureCache: Feature[];\n  // isLoadingAmenities = false\n  isLoadingFeatures = false\n\n  constructor() {\n    this.authorize = this.authorize.bind(this);\n    this.subscribe = this.subscribe.bind(this);\n    this.unsubscribe = this.unsubscribe.bind(this);\n    this.amenityCache = [];\n    this.featureCache = [];\n  }\n\n  async authorize(token: string) {\n    if (this.token.length > 0) {\n      console.log('ProximiioMapbox already authorized, skipping')\n      return\n    }\n\n    this.token = token;\n\n    Proximiio.subscribe(ProximiioEvents.PositionUpdated, (location: ProximiioLocation) => {\n      ProximiioMapboxNative.updateLocation(location.lat, location.lng, location.sourceType, location.accuracy).then((result: ProximiioLocation) => {\n        // let location: ProximiioLocation = {\n        //   lng: result.lng,\n        //   lat: result.lat,\n        //   sourceType: result.sourceType,\n        //   accuracy: result.accuracy,\n        // };\n        this.emitter.emit(ProximiioMapboxEvents.LOCATION_UPDATED, result);\n      });\n    });\n    Proximiio.subscribe(ProximiioEvents.FloorChanged, (floor: ProximiioFloor) => {\n      if (isIOS) {\n        ProximiioMapboxNative.updateFloor(floor.id);\n      } else {\n        ProximiioMapboxNative.updateLevel(floor.level);\n      }\n    });\n\n    this.subscribe(ProximiioMapboxEvents.ROUTE, evt => this.route.onCalculated(evt));\n    this.subscribe(ProximiioMapboxEvents.ROUTE_UPDATE, evt => this.route.onUpdate(evt));\n    this.subscribe(ProximiioMapboxInternalEvents.AMENITIES_CHANGED, this.__amenitiesChanged.bind(this));\n    this.subscribe(ProximiioMapboxInternalEvents.FEATURES_CHANGED, this.__featuresChanged.bind(this));\n\n    await ProximiioMapboxNative.authorize(token);\n\n    this.axios = axios.create({\n      baseURL: 'https://api.proximi.fi',\n      timeout: 60000,\n      headers: {'Authorization': `Bearer ${token}`}\n    });\n\n    this.style = (await this.axios.get('/v5/geo/style')).data;\n  }\n\n  get styleURL() {\n    if (this.token === '') {\n      throw new Error('ProximiioMapbox is not authorized')\n    }\n\n    return `https://api.proximi.fi/v5/geo/style?token=${this.token}`\n  }\n\n  isReady(): Promise<boolean> {\n    return ProximiioMapboxNative.isReady();\n  }\n\n  search(title: string): Promise<Feature[]> {\n    return ProximiioMapboxNative.search(title);\n  }\n\n  getAmenityCategories(): Promise<AmenityCategory[]> {\n    return ProximiioMapboxNative.getAmenityCategories();\n  }\n  __amenitiesChanged(amenities: Amenity[]) {\n    this.amenityCache = amenities;\n    this.emitter.emit(ProximiioMapboxEvents.AMENITIES_CHANGED);\n  }\n\n  async __featuresChanged(features: Feature[]) {\n    this.featureCache = features.map((f: Feature) => {\n      return new Feature(Platform.OS === 'ios' ? f : JSON.parse(f as unknown as string));\n    });\n    this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n  }\n\n  getAmenities(): Amenity[] {\n    return this.amenityCache;\n  }\n\n  getFeatures(): Feature[] {\n    return this.featureCache;\n  }\n\n  // TODO: this flow was replaced due to frequent race conditions\n  // async getAmenities(): Promise<Amenity[]> {\n  //   if (this.amenityCache.length > 0) {\n  //     return this.amenityCache;\n  //   }\n  //\n  //   const local = await AsyncStorage.getItem('proximiio:amenities');\n  //\n  //   if (local) {\n  //     const parsed = JSON.parse(local);\n  //     console.log('getAmenities - local | count: ', parsed.length, parsed);\n  //     if (parsed.length > 0) {\n  //       this.amenityCache = JSON.parse(local) as Amenity[];\n  //       console.log('getAmenities - local used: ', this.amenityCache);\n  //       return this.amenityCache;\n  //     }\n  //   }\n  //\n  //   if (this.isLoadingAmenities) {\n  //     console.log('isLoadingAmenities!');\n  //     return [] as Amenity[]\n  //   }\n  //\n  //   if (Platform.OS === 'ios') {\n  //     await ProximiioMapboxNative.syncAmenities();\n  //   }\n  //\n  //   this.isLoadingAmenities = true;\n  //   this.amenityCache = (await ProximiioMapboxNative.getAmenities()) as Amenity[];\n  //   await AsyncStorage.setItem('proximiio:amenities', JSON.stringify(this.amenityCache));\n  //   this.emitter.emit(ProximiioMapboxEvents.AMENITIES_CHANGED);\n  //\n  //   console.log('getAmenities | count: ', this.amenityCache.length);\n  //   return this.amenityCache;\n  // }\n  //\n  // async getFeatures(): Promise<Feature[]> {\n  //   if (this.featureCache.length > 0) {\n  //     return this.featureCache\n  //   }\n  //\n  //   const local = await AsyncStorage.getItem('proximiio:features');\n  //\n  //   if (local) {\n  //     const parsed = JSON.parse(local);\n  //     if (parsed.length > 0) {\n  //       this.featureCache = JSON.parse(local).map((f: any) => new Feature(f));\n  //       this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n  //       return this.featureCache;\n  //     }\n  //   }\n  //\n  //   if (this.isLoadingFeatures) {\n  //     return [] as Feature[]\n  //   }\n  //\n  //   this.isLoadingFeatures = true;\n  //\n  //   if (Platform.OS === 'ios') {\n  //     await ProximiioMapboxNative.syncFeatures();\n  //   }\n  //\n  //   const native = (await ProximiioMapboxNative.getFeatures())\n  //     .map((f: ProximiioFeatureType) => new Feature(Platform.OS === 'ios' ? f : JSON.parse(f as unknown as string) ))\n  //\n  //   this.featureCache = native;\n  //   await AsyncStorage.setItem('proximiio:features', JSON.stringify(this.featureCache));\n  //   this.isLoadingFeatures = false;\n  //   if (native.length > 0) {\n  //     this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n  //   }\n  //   return this.featureCache\n  // }\n\n  // TODO is this necessary?\n  async syncFeatures(): Promise<void> {\n    await AsyncStorage.removeItem('proximiio:features');\n    this.isLoadingFeatures = true;\n\n    if (Platform.OS === 'ios') {\n      await ProximiioMapboxNative.syncFeatures();\n    }\n\n    const native = (await ProximiioMapboxNative.getFeatures())\n      .map((f: ProximiioFeatureType) => new Feature(Platform.OS === 'ios' ? f : JSON.parse(f as unknown as string) ))\n\n    this.featureCache = native;\n    await AsyncStorage.setItem('proximiio:features', JSON.stringify(this.featureCache));\n    this.isLoadingFeatures = false;\n    if (native.length > 0) {\n      this.emitter.emit(ProximiioMapboxEvents.FEATURES_CHANGED);\n    }\n  }\n\n  getStyle(): Promise<string> {\n    return ProximiioMapboxNative.getStyle();\n  }\n\n  getSyncStatus(): Promise<number> {\n    return ProximiioMapboxNative.getSyncStatus();\n  }\n\n  startSyncNow() {\n    ProximiioMapboxNative.startSyncNow();\n  }\n\n  /**\n   * Map int -> int, e.g.: <code>{'-1': 0, '0': 1, '1': 2}</code>\n   */\n  setLevelOverrideMap(levelOverrideMap: Map<number, number>) {\n    ProximiioMapboxNative.setLevelOverrideMap(levelOverrideMap);\n  }\n\n  // configure units that should be used for guidance (please make sure you have defined this unit in guidance translations in editor)\n  setUnitConversion(unitConversion: ProximiioUnitConversion) {\n    if (isIOS) {\n      ProximiioMapboxNative.setUnitConversion(unitConversion);\n    } else {\n      ProximiioMapboxNative.setUnitConversion(JSON.stringify(unitConversion));\n    }\n  }\n\n  // set distance before a change in direction when the instruction should be considered 'immediate'\n  setStepImmediateThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setStepImmediateThreshold(thresholdInMeters);\n  }\n\n  // set distance before a change in direction when the instruction should be considered comming 'soon' and possibly warn the user about upcoming event\n  setStepPreparationThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setStepPreparationThreshold(thresholdInMeters);\n  }\n\n  // set a threshold which regulates how far from a destination user must be to be considered he arrived,\n  setRouteFinishThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setRouteFinishThreshold(thresholdInMeters);\n  }\n\n  // enable rerouting if the user strays from path\n  setRerouteEnabled(enabled: boolean) {\n    ProximiioMapboxNative.setRerouteEnabled(enabled);\n  }\n\n  // // configure threshold when the user is considered strayed from path\n  setReRouteThreshold(thresholdInMeters: number) {\n    ProximiioMapboxNative.setReRouteThreshold(thresholdInMeters);\n  }\n\n  setUserLocationToRouteSnappingEnabled(enabled: boolean) {\n    ProximiioMapboxNative.setUserLocationToRouteSnappingEnabled(enabled);\n  }\n\n  setUserLocationToRouteSnappingThreshold(threshold: number) {\n    ProximiioMapboxNative.setUserLocationToRouteSnappingThreshold(threshold);\n  }\n\n  ttsEnabled(enabled: boolean) {\n    if (enabled) {\n      ProximiioMapboxNative.ttsEnable();\n    } else {\n      ProximiioMapboxNative.ttsDisable();\n    }\n  }\n\n  /**\n   * Enables TTS user warnings about:\n   * - starting orientation of the route (which way should user turn to start walking)\n   * - when user is walking the wrong way.\n   * @param enabled\n   */\n  ttsHeadingCorrectionEnabled(enabled: boolean) {\n    ProximiioMapboxNative.ttsHeadingCorrectionEnabled(enabled);\n  }\n\n  /**\n   * Set thresholds to determine when is the heading correction triggered.\n   * @param thresholdMeters distance from route to trigger correction. Default 3 meters.\n   * @param thresholdDegrees degrees between current heading and heading towards correct route. Default 90 degrees.\n   */\n  ttsHeadingCorrectionThresholds(thresholdDistanceMeters: number, thresholdDegrees: number) {\n    ProximiioMapboxNative.ttsHeadingCorrectionThresholds(thresholdDistanceMeters, thresholdDegrees);\n  }\n\n  ttsReassuranceInstructionEnabled(enabled: boolean) {\n    ProximiioMapboxNative.ttsReassuranceInstructionEnabled(enabled);\n  }\n\n  ttsReassuranceInstructionDistance(distance: Number) {\n    ProximiioMapboxNative.ttsReassuranceInstructionDistance(distance);\n  }\n\n  ttsRepeatLastInstruction() {\n    ProximiioMapboxNative.ttsRepeatLastInstruction();\n  }\n\n  ttsHazardAlert(enabled: boolean, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsHazardAlert(enabled, metadataKeys);\n  }\n\n  ttsSegmentAlert(emterEnabled: boolean, exitEnabled: boolean, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsSegmentAlert(emterEnabled, exitEnabled, metadataKeys);\n  }\n\n  ttsDecisionAlert(enabled: boolean, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsDecisionAlert(enabled, metadataKeys);\n  }\n\n  ttsLandmarkAlert(enabled: true, metadataKeys: number[] = []) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsLandmarkAlert(enabled, metadataKeys);\n  }\n\n  ttsLevelChangerMetadataKeys(metadataKeys: number[]) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsLevelChangerMetadataKeys(metadataKeys);\n  }\n\n  ttsDestinationMetadataKeys(metadataKeys: number[]) {\n    if (metadataKeys == undefined) metadataKeys = [];\n    ProximiioMapboxNative.ttsLevelChangerMetadataKeys(metadataKeys);\n  }\n\n  subscribe(event: string, fn: (data: any) => void) {\n    return this.emitter.addListener(event, fn);\n  }\n\n  unsubscribe(event: string, fn: (data: any) => void) {\n    return this.emitter.removeListener(event, fn);\n  }\n}\n\nexport default new ProximiioMapbox()\n"]}