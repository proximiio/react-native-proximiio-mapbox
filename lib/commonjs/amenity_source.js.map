{"version":3,"sources":["amenity_source.tsx"],"names":["AmenitySource","props","syncKey","Date","getTime","images","onChange","bind","amenities","ProximiioMapbox","getAmenities","console","log","length","filter","a","icon","forEach","amenity","id","uri","scale","setState","subscribe","ProximiioMapboxEvents","AMENITIES_CHANGED","unsubscribe","_nextProps","nextState","state","React","Component"],"mappings":"y6BAAA,oDACA,0EACA,6DAEA,qE,+yDAaaA,CAAAA,a,0HAMX,uBAAYC,KAAZ,CAA0B,4DACxB,uBAAMA,KAAN,EADwB,gFALlB,CACNC,OAAO,6BAA8B,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAD/B,CAENC,MAAM,CAAE,EAFF,CAKkB,EAExB,MAAKC,QAAL,CAAgB,MAAKA,QAAL,CAAcC,IAAd,4CAAhB,CAFwB,aAGzB,C,+DAED,4JACQC,SADR,CACoBC,kBAAgBC,YAAhB,EADpB,CAEEC,OAAO,CAACC,GAAR,CAAY,iCAAZ,CAA+CJ,SAAS,CAACK,MAAzD,EACMR,MAHR,CAGiB,EAHjB,CAOEG,SAAS,CACNM,MADH,CACU,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACC,IAAF,EAAUD,CAAC,CAACC,IAAF,CAAOH,MAAP,CAAgB,GAA9B,EADX,EAEGI,OAFH,CAEW,SAAAC,OAAO,QAAMb,CAAAA,MAAM,CAACa,OAAO,CAACC,EAAT,CAAN,CAAqB,CAAEC,GAAG,CAAEF,OAAO,CAACF,IAAf,CAAqBK,KAAK,CAAE,CAA5B,CAA3B,EAFlB,EAGA,KAAKC,QAAL,CAAc,CAAEjB,MAAM,CAANA,MAAF,CAAUH,OAAO,6BAA8B,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAA/C,CAAd,EAVF,qE,iCAaA,4BAAoB,CAClB,KAAKE,QAAL,GACAG,kBAAgBc,SAAhB,CACEC,gCAAsBC,iBADxB,CAEE,KAAKnB,QAFP,EAID,C,oCAED,+BAAuB,CACrBG,kBAAgBiB,WAAhB,CACEF,gCAAsBC,iBADxB,CAEE,KAAKnB,QAFP,EAID,C,qCAED,+BAAsBqB,UAAtB,CAAyCC,SAAzC,CAA2D,CACzD,GAAI,oBAAMA,SAAN,CAAiB,KAAKC,KAAtB,CAAJ,CAAkC,CAChC,MAAO,MAAP,CACD,CACD,MAAO,KAAP,CACD,C,sBAED,iBAAS,CACP,MACE,8BAAC,aAAD,CAAU,MAAV,EACE,GAAG,CAAE,KAAKA,KAAL,CAAW3B,OADlB,CAEE,MAAM,CAAE,KAAK2B,KAAL,CAAWxB,MAFrB,4EADF,CAMD,C,2BArDgCyB,eAAMC,S","sourcesContent":["import React from 'react';\nimport MapboxGL from '@react-native-mapbox-gl/maps';\nimport ProximiioMapbox, { Amenity, ProximiioMapboxEvents } from './instance';\nimport {blueDot, directionCone} from './helpers';\nimport equal from 'fast-deep-equal/react';\n\nexport type URIImages = {\n  [id: string]: { uri: string, scale: number };\n};\n\ninterface Props {}\n\ninterface State {\n  syncKey: string;\n  images: URIImages;\n}\n\nexport class AmenitySource extends React.Component<Props, State> {\n  state = {\n    syncKey: `proximiio-amenity-source-${new Date().getTime()}`,\n    images: {} as URIImages,\n  };\n\n  constructor(props: Props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  async onChange() {\n    const amenities = ProximiioMapbox.getAmenities();\n    console.log('amenity source onChange, size: ', amenities.length);\n    const images = {\n      // bluedot: { uri: blueDot, scale: 1 },\n      // bluedotWithCone: { uri: blueDotWithCone, scale: 1 }\n    } as URIImages;\n    amenities\n      .filter(a => a.icon && a.icon.length > 256 )\n      .forEach(amenity => ( images[amenity.id] = { uri: amenity.icon, scale: 1 }));\n    this.setState({ images, syncKey: `proximiio-amenity-source-${new Date().getTime()}` });\n  }\n\n  componentDidMount() {\n    this.onChange();\n    ProximiioMapbox.subscribe(\n      ProximiioMapboxEvents.AMENITIES_CHANGED,\n      this.onChange\n    );\n  }\n\n  componentWillUnmount() {\n    ProximiioMapbox.unsubscribe(\n      ProximiioMapboxEvents.AMENITIES_CHANGED,\n      this.onChange\n    );\n  }\n\n  shouldComponentUpdate(_nextProps: Props, nextState: State) {\n    if (equal(nextState, this.state)) {\n      return false\n    }\n    return true\n  }\n\n  render() {\n    return (\n      <MapboxGL.Images\n        key={this.state.syncKey}\n        images={this.state.images}\n      />\n    );\n  }\n}\n"]}